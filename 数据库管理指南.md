# 数据库管理指南

## 📋 概述

本指南介绍如何管理项目数据库，包括导出干净状态和恢复到初始状态。

## 🧹 当前数据库状态

数据库已清理完毕，当前状态：
- ✅ 保留了完整的数据库结构（24个表）
- ✅ 保留了4个管理员账户
- ✅ 保留了系统配置数据
- ❌ 删除了所有业务数据（用户、订单、打卡记录等）

### 保留的管理员账户

| ID | 姓名 | 手机号 | 密码 | 状态 |
|----|------|--------|------|------|
| 14 | 超级管理员2 | 13800000002 | admin123456 | 激活 |
| 15 | 超级管理员3 | 13800000003 | admin123456 | 激活 |
| 16 | 超级管理员4 | 13800000004 | admin123456 | 激活 |
| 21 | 超级管理员1 | 13800000001 | admin123456 | 激活 |

## 📁 相关文件

### SQL文件
- `backend/sql/clean_database_with_admins.sql` - 干净数据库的完整导出文件

### 脚本文件
- `backend/server/export-clean-database.js` - 导出当前数据库状态
- `backend/server/import-clean-database.js` - 导入干净数据库状态
- `restore-clean-database.bat` - Windows一键恢复脚本

## 使用方法

### 方法1：使用批处理文件（推荐）

1. 双击运行 `restore-clean-database.bat`
2. 按提示确认操作
3. 等待恢复完成

### 方法2：使用Node.js脚本

```bash
# 进入后端目录
cd backend/server

# 恢复干净数据库
node import-clean-database.js
```

### 方法3：使用MySQL命令行

```bash
# 使用MySQL命令行导入
mysql -u root -p author_center < backend/sql/clean_database_with_admins.sql
```

### 方法4：使用数据库管理工具

1. 打开phpMyAdmin、Navicat等数据库管理工具
2. 选择 `author_center` 数据库
3. 导入 `backend/sql/clean_database_with_admins.sql` 文件

## 🔄 重新导出干净状态

如果您修改了系统配置或管理员信息，想要重新导出干净状态：

```bash
# 进入后端目录
cd backend/server

# 导出当前状态
node export-clean-database.js
```

这将更新 `backend/sql/clean_database_with_admins.sql` 文件。

## ⚠️ 注意事项

1. **数据备份**：恢复操作会清空所有现有数据，请确保重要数据已备份
2. **环境要求**：确保已安装Node.js和MySQL，并正确配置了`.env`文件
3. **权限检查**：确保数据库用户有足够的权限执行DDL和DML操作
4. **服务停止**：建议在恢复数据库前停止后端服务

## 🛠️ 故障排除

### 常见问题

1. **连接失败**
   - 检查`.env`文件中的数据库配置
   - 确保MySQL服务正在运行
   - 验证用户名和密码

2. **权限错误**
   - 确保数据库用户有CREATE、DROP、INSERT、DELETE权限
   - 检查FOREIGN_KEY_CHECKS设置

3. **文件不存在**
   - 确保SQL文件路径正确
   - 重新运行导出脚本生成SQL文件

### 手动验证

恢复完成后，可以手动检查：

```sql
-- 检查管理员数量
SELECT COUNT(*) FROM managers WHERE status = 1;

-- 检查业务表是否为空
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM orders;
SELECT COUNT(*) FROM players;
```

## 技术支持

如果遇到问题，请检查：
1. 控制台错误信息
2. MySQL错误日志
3. Node.js版本兼容性
4. 网络连接状态

---

*最后更新：2025年1月*