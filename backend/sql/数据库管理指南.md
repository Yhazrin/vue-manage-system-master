# 数据库管理指南

## 概述

本指南详细介绍了如何管理项目数据库，包括数据库的恢复、导入和维护操作。

## 数据库版本说明

### 1. 干净版本（Clean Version）
**文件：** `clean_database_with_admins.sql`

#### 保留内容
- ✅ 完整的数据库表结构
- ✅ 4个管理员账户（admin, 超级管理员1, 超级管理员2, 超级管理员3）
- ✅ 系统配置数据（提成配置、全局时薪设置、订单收益配置、平台配置）

#### 清空内容
- ❌ 所有用户账户
- ❌ 所有陪玩账户
- ❌ 所有客服账户
- ❌ 所有订单数据
- ❌ 所有打卡记录
- ❌ 所有收益记录
- ❌ 所有游戏数据
- ❌ 所有礼物数据
- ❌ 所有评论数据
- ❌ 所有收藏数据

#### 适用场景
- 🎯 生产环境部署
- 🎯 重新开始项目
- 🎯 清理测试数据
- 🎯 系统初始化

### 2. 完整示例版本（Complete Version）
**文件：** `database_complete.sql`

#### 包含内容
- ✅ 完整的数据库表结构
- ✅ 管理员账户
- ✅ 示例客服账户
- ✅ 示例陪玩账户
- ✅ 示例游戏和礼品数据
- ✅ 系统配置数据
- ✅ 高级功能（索引、视图、存储过程、触发器）

#### 适用场景
- 🎯 功能演示
- 🎯 开发测试
- 🎯 功能验证
- 🎯 学习参考

### 3. 增强版本（Enhanced Version）⭐ 推荐
**文件：** `database_enhanced_with_real_data.sql`

#### 包含内容
- ✅ 完整的数据库表结构和系统配置
- ✅ **4个管理员账户**（完整权限配置）
- ✅ **6个客服账户**（不同等级和权限，完整个人信息）
  - 高级客服：cs_manager_001（全权限）
  - 资深客服：cs_senior_002（部分权限）
  - 普通客服：cs_staff_003, cs_staff_004
  - 新手客服：cs_junior_005, cs_junior_006
- ✅ **10个陪玩账户**（覆盖6款热门游戏，详细资料）
  - 王者荣耀：甜心小雨、电竞女神、萌萌哒
  - 和平精英：狙击女王、突击小队长
  - 原神：旅行者小姐、元素法师
  - 英雄联盟：峡谷女帝、辅助天使
  - 其他游戏：全能选手
- ✅ **10个用户账户**（完整个人信息）
- ✅ **6款热门游戏**（王者荣耀、和平精英、原神、英雄联盟、绝地求生、DOTA2）
- ✅ **8种礼物**（不同价位：1元-1000元）
- ✅ **15个订单**（不同状态和类型）
  - 已完成订单：5个
  - 进行中订单：3个
  - 待接单订单：2个
  - 待审核订单：2个
  - 匿名用户订单：3个
- ✅ **完整的业务数据**
  - 礼物记录：9条
  - 收藏记录：16条
  - 评论数据：5条
  - 打卡记录：12条
  - 提现记录：8条
  - 统计数据：15条

#### 数据特色
- 🌟 **真实性**：所有数据都具有真实性，包含完整的个人信息、工作记录、收益数据
- 🌟 **完整性**：覆盖系统所有功能模块，数据关联完整
- 🌟 **多样性**：不同类型的用户、订单状态、业务场景
- 🌟 **实用性**：可直接用于功能测试、演示展示、培训教学

#### 适用场景
- 🎯 **功能演示**（最佳选择）
- 🎯 **开发测试**（完整数据支持）
- 🎯 **培训教学**（真实业务场景）
- 🎯 **系统验证**（全功能测试）

## 相关文件

### SQL文件
- `clean_database_with_admins.sql` - 干净的数据库导出文件（只包含管理员和系统配置）
- `database_complete.sql` - 完整的数据库文件（包含示例数据）
- `database_enhanced_with_real_data.sql` - 增强版数据库文件（包含完整真实数据）⭐ 推荐

### 脚本文件
- `import-clean-database.js` - Node.js 导入脚本（干净版）
- `import-complete-database.js` - Node.js 导入脚本（完整版）
- `import-enhanced-database.js` - Node.js 导入脚本（增强版）⭐ 推荐
- `restore-clean-database.bat` - Windows 一键恢复批处理（干净版）
- `restore-complete-database.bat` - Windows 一键恢复批处理（完整版）
- `restore-enhanced-database.bat` - Windows 一键恢复批处理（增强版）⭐ 推荐

## 使用方法

### 方法一：Windows 批处理文件（推荐）

#### 干净版本
```bash
# 双击运行
restore-clean-database.bat
```

#### 完整版本
```bash
# 双击运行
restore-complete-database.bat
```

#### 增强版本（推荐）
```bash
# 双击运行
restore-enhanced-database.bat
```

### 方法二：Node.js 脚本

#### 干净版本
```bash
node import-clean-database.js
```

#### 完整版本
```bash
node import-complete-database.js
```

#### 增强版本（推荐）
```bash
node import-enhanced-database.js
```

### 方法三：MySQL 命令行

#### 干净版本
```bash
mysql -u root -p author_center < clean_database_with_admins.sql
```

#### 完整版本
```bash
mysql -u root -p author_center < database_complete.sql
```

#### 增强版本（推荐）
```bash
mysql -u root -p author_center < database_enhanced_with_real_data.sql
```

## 默认账户信息

### 管理员账户
- **用户名：** admin
- **密码：** admin123
- **权限：** 超级管理员

### 客服账户示例（增强版）
- **用户名：** cs_manager_001
- **密码：** cs123456
- **权限：** 高级客服（全权限）

### 陪玩账户示例（增强版）
- **用户名：** 甜心小雨
- **密码：** player123
- **游戏：** 王者荣耀
- **特色：** 温柔甜美，星耀段位

### 用户账户示例（增强版）
- **用户名：** 张三
- **密码：** user123
- **类型：** 普通用户

## 版本选择建议

### 🏆 推荐：增强版本
- ✅ **最适合演示展示**
- ✅ **最适合功能测试**
- ✅ **最适合培训教学**
- ✅ **数据最完整真实**

### 🔧 开发测试：完整版本
- ✅ 包含基础示例数据
- ✅ 有高级功能支持
- ✅ 适合功能验证

### 🚀 生产部署：干净版本
- ✅ 只保留必要配置
- ✅ 无测试数据干扰
- ✅ 适合正式环境

## 注意事项

### 环境要求
- ✅ Node.js 环境
- ✅ MySQL 数据库
- ✅ 正确的 .env 配置文件

### 数据备份
- ⚠️ 导入前请备份现有数据
- ⚠️ 导入操作会覆盖现有数据
- ⚠️ 建议在测试环境先验证

### 权限检查
- ✅ 确保数据库用户有足够权限
- ✅ 检查数据库连接配置
- ✅ 验证目标数据库存在

### 服务停止
- 🛑 导入前建议停止相关服务
- 🛑 避免数据冲突和锁定问题

## 故障排除

### 常见问题

#### 1. 连接失败
```
错误：ECONNREFUSED
解决：检查MySQL服务状态和连接配置
```

#### 2. 权限不足
```
错误：ER_ACCESS_DENIED_ERROR
解决：检查数据库用户名密码和权限
```

#### 3. 数据库不存在
```
错误：ER_BAD_DB_ERROR
解决：先创建目标数据库
```

#### 4. 文件不存在
```
错误：文件路径错误
解决：检查SQL文件和脚本文件路径
```

### 手动验证

#### 检查数据导入结果
```sql
-- 检查各表数据量
SELECT 
    'admins' as table_name, COUNT(*) as count FROM admins
UNION ALL
SELECT 'customer_services_super_unified', COUNT(*) FROM customer_services_super_unified
UNION ALL
SELECT 'players', COUNT(*) FROM players
UNION ALL
SELECT 'users', COUNT(*) FROM users
UNION ALL
SELECT 'games', COUNT(*) FROM games
UNION ALL
SELECT 'orders', COUNT(*) FROM orders;
```

#### 验证账户登录
```sql
-- 检查管理员账户
SELECT username, status FROM admins WHERE username = 'admin';

-- 检查客服账户（增强版）
SELECT username, status, is_online FROM customer_services_super_unified LIMIT 3;

-- 检查陪玩账户（增强版）
SELECT name, status, online_status FROM players LIMIT 3;
```

## 技术支持

### 联系方式
- 📧 技术支持邮箱：support@company.com
- 📱 技术支持电话：400-xxx-xxxx
- 💬 在线客服：工作日 9:00-18:00

### 常用命令

#### 查看数据库状态
```bash
# 检查MySQL服务
net start mysql

# 连接数据库
mysql -u root -p

# 查看数据库列表
SHOW DATABASES;

# 使用数据库
USE author_center;

# 查看表列表
SHOW TABLES;
```

#### 备份数据库
```bash
# 备份整个数据库
mysqldump -u root -p author_center > backup_$(date +%Y%m%d_%H%M%S).sql

# 备份指定表
mysqldump -u root -p author_center table_name > table_backup.sql
```

---

**最后更新：** 2025-01-27  
**版本：** v3.0（新增增强版本）  
**维护者：** 开发团队