# 项目安装运行指南

## 系统要求

### 基础环境
- **操作系统**：Windows 10/11, macOS 10.15+, Ubuntu 18.04+
- **Node.js**：版本 16.0+ (推荐 18.x LTS)
- **npm**：版本 8.0+ (随 Node.js 安装)
- **MySQL**：版本 8.0+ (推荐 8.0.33)
- **Git**：版本 2.30+

### 硬件要求
- **内存**：最少 4GB，推荐 8GB+
- **存储**：至少 2GB 可用空间
- **网络**：稳定的互联网连接

---

## 第一步：环境准备

### 1.1 安装 Node.js

#### Windows 系统
1. 访问 [Node.js 官网](https://nodejs.org/)
2. 下载 LTS 版本（推荐 18.x）
3. 运行安装程序，按默认设置安装
4. 验证安装：
```bash
node --version
npm --version
```

#### macOS 系统
```bash
# 使用 Homebrew 安装
brew install node

# 或者下载官方安装包
# 访问 https://nodejs.org/ 下载 .pkg 文件
```

#### Linux 系统
```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# CentOS/RHEL
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs
```

### 1.2 安装 MySQL

#### Windows 系统
1. 访问 [MySQL 官网](https://dev.mysql.com/downloads/mysql/)
2. 下载 MySQL Community Server 8.0+
3. 运行安装程序，设置 root 密码
4. 启动 MySQL 服务

#### macOS 系统
```bash
# 使用 Homebrew 安装
brew install mysql
brew services start mysql

# 设置 root 密码
mysql_secure_installation
```

#### Linux 系统
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install mysql-server
sudo systemctl start mysql
sudo systemctl enable mysql

# 设置 root 密码
sudo mysql_secure_installation
```

### 1.3 安装 Git
访问 [Git 官网](https://git-scm.com/) 下载并安装适合你操作系统的版本。

---

## 第二步：获取项目代码

### 2.1 克隆项目（如果有远程仓库）
```bash
git clone <项目仓库地址>
cd vue-manage-system-master
```

### 2.2 或者直接使用现有项目文件
如果你已经有项目文件，直接进入项目目录：
```bash
cd vue-manage-system-master
```

---

## 第三步：数据库配置

### 3.1 创建数据库
```bash
# 登录 MySQL
mysql -u root -p

# 在 MySQL 命令行中执行
CREATE DATABASE author_center CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

### 3.2 导入数据库结构和数据
```bash
# 导入完整数据库文件
mysql -u root -p author_center < database_complete.sql
```

### 3.3 验证数据库
```bash
# 登录数据库
mysql -u root -p

# 切换到项目数据库
USE author_center;

# 查看表结构
SHOW TABLES;

# 查看测试数据
SELECT * FROM admins;
SELECT * FROM customer_services_super_unified;
```

---

## 第四步：后端配置和启动

### 4.1 进入后端目录
```bash
cd backend/server
```

### 4.2 安装依赖
```bash
npm install
```

如果遇到网络问题，可以使用国内镜像：
```bash
npm install --registry=https://registry.npmmirror.com
```

### 4.3 配置环境变量
创建 `.env` 文件（如果不存在）：
```bash
# Windows
copy .env.example .env

# macOS/Linux
cp .env.example .env
```

编辑 `.env` 文件，配置数据库连接：
```env
# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASS=你的MySQL密码
DB_NAME=author_center

# 服务器配置
PORT=3000
NODE_ENV=development

# JWT 密钥
JWT_SECRET=your-secret-key-here

# 其他配置
CORS_ORIGIN=http://localhost:5173
```

### 4.4 启动后端服务
```bash
npm start
```

成功启动后，你应该看到类似输出：
```
Server running on port 3000
Database connected successfully
```

### 4.5 验证后端服务
打开浏览器访问：`http://localhost:3000/api/health`
应该返回：`{"status": "OK", "message": "Server is running"}`

---

## 第五步：前端配置和启动

### 5.1 打开新终端，进入前端目录
```bash
cd frontend
# 或者如果你在 backend/server 目录
cd ../../frontend
```

### 5.2 安装依赖
```bash
npm install
```

如果遇到依赖冲突，可以尝试：
```bash
npm install --legacy-peer-deps
```

### 5.3 配置前端环境
检查 `vite.config.ts` 文件，确保代理配置正确：
```typescript
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true
      }
    }
  }
})
```

### 5.4 启动前端开发服务器
```bash
npm run dev
```

成功启动后，你应该看到类似输出：
```
  VITE v4.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

---

## 第六步：访问系统

### 6.1 管理员端
- 访问地址：`http://localhost:5173/admin/login`
- 默认账户：
  - 用户名：`admin`
  - 密码：`password`

### 6.2 客服端
- 访问地址：`http://localhost:5173/customer-service/login`
- 测试账户：
  - 用户名：`cs001`
  - 密码：`password123`

### 6.3 玩家端
- 访问地址：`http://localhost:5173/player/login`
- 测试账户：
  - 用户名：`player001`
  - 密码：`password123`

---

## 常见问题解决

### 问题1：端口被占用
```bash
# 查看端口占用
netstat -ano | findstr :3000  # Windows
lsof -i :3000                 # macOS/Linux

# 杀死占用进程
taskkill /PID <进程ID> /F      # Windows
kill -9 <进程ID>               # macOS/Linux
```

### 问题2：数据库连接失败
1. 检查 MySQL 服务是否启动
2. 验证 `.env` 文件中的数据库配置
3. 确认数据库用户权限
4. 检查防火墙设置

### 问题3：npm 安装依赖失败
```bash
# 清除 npm 缓存
npm cache clean --force

# 删除 node_modules 重新安装
rm -rf node_modules package-lock.json  # macOS/Linux
rmdir /s node_modules & del package-lock.json  # Windows
npm install
```

### 问题4：前端页面空白
1. 检查浏览器控制台错误
2. 确认后端服务正常运行
3. 检查网络请求是否成功
4. 验证路由配置

### 问题5：跨域问题
确保后端 CORS 配置正确：
```javascript
// 在 app.js 中
app.use(cors({
  origin: 'http://localhost:5173',
  credentials: true
}));
```

---

## 开发模式 vs 生产模式

### 开发模式（当前配置）
- 前端：`npm run dev` (Vite 开发服务器)
- 后端：`npm start` (nodemon 自动重启)
- 数据库：本地 MySQL

### 生产模式部署
```bash
# 前端构建
cd frontend
npm run build

# 后端生产启动
cd backend/server
npm run prod
```

---

## 第七步：宝塔面板服务器部署

### 7.1 服务器环境准备

#### 7.1.1 安装宝塔面板
```bash
# CentOS/RHEL 系统
yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh

# Ubuntu/Debian 系统
wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh

# 安装完成后记录面板地址、用户名和密码
```

#### 7.1.2 宝塔面板基础配置
1. **登录宝塔面板**：使用安装时提供的地址和账户登录
2. **安装运行环境**：
   - **Nginx**：1.20+ 版本
   - **MySQL**：8.0+ 版本
   - **Node.js**：18.x LTS 版本
   - **PM2**：进程管理器
   - **phpMyAdmin**：数据库管理工具（可选）

### 7.2 上传项目文件

#### 7.2.1 创建网站目录
```bash
# 在宝塔面板中创建网站，或手动创建目录
mkdir -p /www/wwwroot/vue-manage-system
cd /www/wwwroot/vue-manage-system
```

#### 7.2.2 上传项目代码
**方法一：使用宝塔面板文件管理器**
1. 在宝塔面板 → 文件 → 进入网站目录
2. 上传项目压缩包并解压
3. 或者直接拖拽文件夹上传

**方法二：使用 Git 克隆**
```bash
cd /www/wwwroot/vue-manage-system
git clone <你的项目仓库地址> .
```

**方法三：使用 SCP/SFTP 工具**
```bash
# 从本地上传到服务器
scp -r ./vue-manage-system-master/* root@服务器IP:/www/wwwroot/vue-manage-system/
```

### 7.3 数据库配置

#### 7.3.1 创建数据库
1. 在宝塔面板 → 数据库 → 添加数据库
   - 数据库名：`author_center`
   - 用户名：`author_user`（自定义）
   - 密码：设置强密码
   - 访问权限：本地服务器

#### 7.3.2 导入数据库
**方法一：使用宝塔面板**
1. 数据库 → 管理 → 导入
2. 选择 `backend/sql/database_complete.sql` 文件
3. 点击导入

**方法二：使用命令行**
```bash
cd /www/wwwroot/vue-manage-system
mysql -u author_user -p author_center < backend/sql/database_complete.sql
```

### 7.4 后端部署配置

#### 7.4.1 安装后端依赖
```bash
cd /www/wwwroot/vue-manage-system/backend/server
npm install --production
```

#### 7.4.2 配置环境变量
创建生产环境配置文件：
```bash
# 编辑 .env 文件
nano .env
```

```env
# 生产环境数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=author_user
DB_PASS=你设置的数据库密码
DB_NAME=author_center

# 服务器配置
PORT=3000
NODE_ENV=production

# JWT 密钥（请使用强密钥）
JWT_SECRET=your-production-secret-key-here-make-it-strong

# CORS 配置（替换为你的域名）
CORS_ORIGIN=https://yourdomain.com

# 文件上传路径
UPLOAD_PATH=/www/wwwroot/vue-manage-system/uploads

# 日志配置
LOG_LEVEL=info
LOG_PATH=/www/wwwroot/vue-manage-system/logs
```

#### 7.4.3 使用 PM2 管理后端进程
```bash
# 安装 PM2（如果宝塔面板没有自动安装）
npm install -g pm2

# 创建 PM2 配置文件
nano ecosystem.config.js
```

```javascript
module.exports = {
  apps: [{
    name: 'vue-manage-backend',
    script: './src/app.js',
    cwd: '/www/wwwroot/vue-manage-system/backend/server',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: '/www/wwwroot/vue-manage-system/logs/err.log',
    out_file: '/www/wwwroot/vue-manage-system/logs/out.log',
    log_file: '/www/wwwroot/vue-manage-system/logs/combined.log',
    time: true
  }]
};
```

```bash
# 启动后端服务
pm2 start ecosystem.config.js

# 设置开机自启
pm2 startup
pm2 save

# 查看运行状态
pm2 status
pm2 logs vue-manage-backend
```

### 7.5 前端部署配置

#### 7.5.1 构建前端项目
```bash
cd /www/wwwroot/vue-manage-system/frontend

# 安装依赖
npm install

# 修改生产环境配置
nano .env.production
```

```env
# 生产环境 API 地址
VITE_API_BASE_URL=https://yourdomain.com/api
VITE_APP_TITLE=游戏服务管理系统
```

```bash
# 构建生产版本
npm run build
```

#### 7.5.2 配置 Nginx
在宝塔面板 → 网站 → 设置 → 配置文件，添加以下配置：

```nginx
server {
    listen 80;
    listen 443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;
    
    # SSL 证书配置（如果有）
    ssl_certificate /www/server/panel/vhost/cert/yourdomain.com/fullchain.pem;
    ssl_certificate_key /www/server/panel/vhost/cert/yourdomain.com/privkey.pem;
    
    root /www/wwwroot/vue-manage-system/frontend/dist;
    index index.html;
    
    # 前端路由配置
    location / {
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
    }
    
    # API 代理到后端
    location /api/ {
        proxy_pass http://127.0.0.1:3000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # 静态文件缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # 上传文件访问
    location /uploads/ {
        alias /www/wwwroot/vue-manage-system/uploads/;
        expires 1y;
        add_header Cache-Control "public";
    }
    
    # 安全配置
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
}

# HTTP 重定向到 HTTPS（如果配置了 SSL）
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;
    return 301 https://$server_name$request_uri;
}
```

### 7.6 SSL 证书配置（推荐）

#### 7.6.1 申请免费 SSL 证书
1. 在宝塔面板 → 网站 → 设置 → SSL
2. 选择 Let's Encrypt 免费证书
3. 填写域名，点击申请
4. 开启强制 HTTPS

#### 7.6.2 或者上传自有证书
1. 选择"其他证书"
2. 上传证书文件和私钥
3. 保存并开启 SSL

### 7.7 防火墙和安全配置

#### 7.7.1 配置防火墙
```bash
# 在宝塔面板 → 安全 → 防火墙
# 开放必要端口：
# 80 (HTTP)
# 443 (HTTPS)
# 22 (SSH)
# 3306 (MySQL，仅内网)
# 8888 (宝塔面板)

# 关闭不必要的端口，特别是 3000（后端端口）
```

#### 7.7.2 设置访问限制
```bash
# 限制宝塔面板访问 IP
# 在宝塔面板 → 面板设置 → 授权IP
# 添加你的固定 IP 地址
```

### 7.8 监控和维护

#### 7.8.1 设置监控
1. **系统监控**：宝塔面板 → 监控 → 系统监控
2. **网站监控**：设置网站可用性监控
3. **数据库监控**：监控数据库性能和连接数

#### 7.8.2 自动备份
```bash
# 在宝塔面板 → 计划任务 → 添加任务
# 设置数据库自动备份（建议每日备份）
# 设置网站文件备份（建议每周备份）
```

#### 7.8.3 日志管理
```bash
# 查看应用日志
pm2 logs vue-manage-backend

# 查看 Nginx 日志
tail -f /www/wwwroot/vue-manage-system/logs/access.log
tail -f /www/wwwroot/vue-manage-system/logs/error.log

# 设置日志轮转
# 在宝塔面板 → 计划任务 → 添加日志切割任务
```

### 7.9 部署验证

#### 7.9.1 检查服务状态
```bash
# 检查后端服务
pm2 status
curl http://localhost:3000/api/health

# 检查 Nginx 状态
systemctl status nginx

# 检查数据库连接
mysql -u author_user -p -e "USE author_center; SHOW TABLES;"
```

#### 7.9.2 功能测试
1. **访问网站**：https://yourdomain.com
2. **登录测试**：使用默认账户登录各个端
3. **API 测试**：检查各个功能模块是否正常
4. **文件上传**：测试头像上传等功能

### 7.10 常见部署问题

#### 问题1：后端服务启动失败
```bash
# 检查日志
pm2 logs vue-manage-backend

# 常见原因：
# 1. 数据库连接失败 - 检查数据库配置
# 2. 端口被占用 - 修改端口或杀死占用进程
# 3. 依赖缺失 - 重新安装依赖
```

#### 问题2：前端页面无法访问
```bash
# 检查 Nginx 配置
nginx -t

# 重启 Nginx
systemctl restart nginx

# 检查文件权限
chown -R www:www /www/wwwroot/vue-manage-system
chmod -R 755 /www/wwwroot/vue-manage-system
```

#### 问题3：API 请求失败
```bash
# 检查代理配置
# 确保 Nginx 配置中的 proxy_pass 地址正确
# 检查后端服务是否在指定端口运行
```

#### 问题4：文件上传失败
```bash
# 检查上传目录权限
chmod -R 755 /www/wwwroot/vue-manage-system/uploads
chown -R www:www /www/wwwroot/vue-manage-system/uploads

# 检查 Nginx 上传大小限制
# 在 nginx.conf 中添加：
client_max_body_size 50M;
```

### 7.11 性能优化建议

#### 7.11.1 数据库优化
```sql
-- 添加必要的索引
-- 定期清理日志表
-- 优化查询语句
```

#### 7.11.2 缓存配置
```bash
# 启用 Redis 缓存（可选）
# 在宝塔面板安装 Redis
# 修改后端代码使用 Redis 缓存
```

#### 7.11.3 CDN 配置
```bash
# 将静态资源上传到 CDN
# 修改前端构建配置使用 CDN 地址
```

通过以上步骤，你就可以成功将项目部署到使用宝塔面板的服务器上。记得定期备份数据和更新系统补丁以确保安全性。

---

## 项目结构说明

```
vue-manage-system-master/
├── frontend/                 # 前端代码
│   ├── src/
│   │   ├── components/      # 公共组件
│   │   ├── views/          # 页面组件
│   │   ├── router/         # 路由配置
│   │   ├── store/          # 状态管理
│   │   └── utils/          # 工具函数
│   ├── public/             # 静态资源
│   └── package.json        # 前端依赖
├── backend/
│   └── server/             # 后端代码
│       ├── routes/         # API 路由
│       ├── models/         # 数据模型
│       ├── middleware/     # 中间件
│       ├── utils/          # 工具函数
│       └── package.json    # 后端依赖
├── tests/                  # 测试脚本
├── database_complete.sql   # 完整数据库文件
├── 系统角色介绍.md         # 系统说明文档
└── 项目安装运行指南.md     # 本文档
```

---

## 维护和更新

### 定期维护
1. **更新依赖**：定期运行 `npm update` 更新依赖包
2. **数据备份**：定期备份数据库数据
3. **日志清理**：清理过期的日志文件
4. **性能监控**：监控系统性能和资源使用

### 版本控制
```bash
# 提交代码
git add .
git commit -m "描述修改内容"
git push origin main

# 创建版本标签
git tag -a v1.0.0 -m "版本 1.0.0"
git push origin v1.0.0
```

### 故障排查
1. **查看日志**：检查应用和数据库日志
2. **监控资源**：检查 CPU、内存、磁盘使用情况
3. **网络检查**：验证网络连接和防火墙设置
4. **依赖检查**：确认所有依赖服务正常运行

---

## 技术支持

如果在安装或运行过程中遇到问题：

1. **检查日志**：查看控制台输出和错误信息
2. **查阅文档**：参考相关技术文档
3. **社区支持**：在相关技术社区寻求帮助
4. **问题反馈**：记录详细的错误信息和复现步骤

---

## 安全注意事项

1. **密码安全**：使用强密码，定期更换
2. **环境变量**：不要将 `.env` 文件提交到版本控制
3. **数据库安全**：限制数据库访问权限
4. **HTTPS**：生产环境使用 HTTPS 协议
5. **定期更新**：及时更新依赖包和系统补丁

按照以上步骤，你应该能够在新电脑上成功安装和运行整个项目。如果遇到问题，请仔细检查每个步骤的执行结果，并参考常见问题解决方案。